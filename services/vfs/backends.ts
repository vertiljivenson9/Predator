// Full backend logic from IDB and Memory